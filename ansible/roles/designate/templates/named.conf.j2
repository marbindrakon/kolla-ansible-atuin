#jinja2: trim_blocks: False
include "/etc/rndc.key";
options {
        listen-on port {{ designate_bind_port }} { {{ 'api' | kolla_address }}; };
        {% if api_interface != dns_interface %}
        listen-on port {{ designate_bind_port }} { {{ 'dns' | kolla_address }}; };
        {% endif %}
        directory       "/var/lib/named";
        allow-new-zones yes;
        dnssec-validation {{ designate_dnssec_validation }};
        auth-nxdomain no;
        request-ixfr no;
        recursion {{ designate_recursion }};
        {% if designate_forwarders_addresses %}
        forwarders { {{ designate_forwarders_addresses }}; };
        {% endif %}
        minimal-responses yes;
        allow-notify { {% for host in groups['designate-worker'] %}{{ 'api' | kolla_address(host) }};{% endfor %} };
{% for mdns_host in groups['designate-mdns'] %}
        - host: {{ 'dns' | kolla_address(mdns_host) }}
          port: {{ designate_mdns_port }}
{% if designate_use_catalog_zone %}
	catalog-zones {
		zone "{{ designate_catalog_zone_fqdn }}" default-masters {
		{% for mdns_host in groups['designate-mdns'] %}
			{{ 'dns' | kolla_address(mdns_host) }}:{{ designate_mdns_port }};
		{% endfor %}
		};
	};
{% endif %}
};
{% if designate_use_catalog_zone %}
zone "{{ designate_catalog_zone_fqdn }}" {
	type secondary;
	file "catalog.db";
	masters {
	{% for mdns_host in groups['designate-mdns'] %}
		{{ 'dns' | kolla_address(mdns_host) }}:{{ designate_mdns_port }};
	{% endfor %}
	};
};
{% endif %}
controls {
        inet {{ 'api' | kolla_address }} port {{ designate_rndc_port }} allow { {% for host in groups['designate-worker'] %}{{ 'api' | kolla_address(host) }}; {% endfor %} } keys { "rndc-key"; };
};
